import{ab as f,af as p,C as h}from"./vendor-ec7aa2c0.js";function m(e,n=0){let t;return(...r)=>{t&&(t(),t=null),t=b(()=>e(...r),n)}}function b(e,n=0){const t=setTimeout(()=>e(),n);return()=>clearTimeout(t)}function E(e){if(typeof window=="undefined")return f(null);const{debounce:n=250,index_name:t,minimum_length:r=3}=e,o=window.stork;if(!o)throw new ReferenceError("bad dispatch to 'search' (Stork namespace not found)");const s=h(null),{set:i,subscribe:c}=s,u=m(a=>{if(a&&a.length>=r){const d=o.search(t,a);i(d)}else i(null)},n);return{set:u,subscribe:c,update(a){const d=p(s),w=a(d);u(w)}}}const l=new Map,_=({id:e})=>`svst-${e}`;function k(e,n){if(l.has(e))return l.get("id");const{head:t}=document,r=new Promise((o,s)=>{const i=document.createElement("script"),c=_({id:e});i.setAttribute("async","true"),i.setAttribute("id",c),i.setAttribute("src",n),i.setAttribute("type","application/javascript"),i.addEventListener("error",()=>s()),i.addEventListener("load",()=>o()),t.appendChild(i)});return l.set(e,r),r}async function S(e){const{script_url:n,wasm_url:t}=e;let r=window.stork;if(n)if(r)console.warn("[svelte-stork] Stork Search library was previously mounted and initialized, skipping...");else try{await k("stork-search",n),r=window.stork}catch{throw new ReferenceError("bad dispatch to 'initialize' (failed to mount and initialize Stork Search library)")}if(!r)throw new ReferenceError("bad dispatch to 'initialize' (Stork namespace not found)");try{await r.initialize(t)}catch{throw new Error("bad option 'IInitializeOptions.wasm_url' to 'initialize' (failed to download and initialize Stork WASM blob)")}}async function g(e){const{index_name:n,index_url:t,overwrite:r=!1}=e,o=window.stork;if(!o)throw new ReferenceError("bad dispatch to 'register' (Stork namespace not found)");try{await o.downloadIndex(n,t,{forceOverwrite:r})}catch{throw new Error("bad option 'IRegisterOptions.index_url' to 'register' (failed to download and register search index)")}}export{S as initialize,g as register,E as search};
